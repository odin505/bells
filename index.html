<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Liter:wght@400;700&display=swap" rel="stylesheet">
  <title>New Year Canvas</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { 
      margin: 0; padding: 0; height: 100dvh; width: 100%; 
      overflow: hidden; background: #f2f2f7; font-family: 'Liter', sans-serif;
    }
    body { display: flex; flex-direction: column; }

    #canvas-wrapper {
      flex: 1; width: 100%; display: flex; justify-content: center; align-items: center;
      padding: 10px; overflow: hidden;
    }

    canvas {
      background: #fff; max-width: 100%; max-height: 100%;
      touch-action: none; border: 1px solid #ddd; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    #ui {
      background: #fff; width: 100%; flex-shrink: 0;
      padding: 12px 15px;
      padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
      display: flex; flex-direction: column; gap: 10px;
      border-top: 1px solid #ddd;
    }

    .palette { display: flex; justify-content: center; gap: 8px; }
    .color-dot { width: 32px; height: 32px; border: 2px solid transparent; cursor: pointer; border-radius: 50%; }
    .color-dot.active { border-color: #000; transform: scale(1.1); }

    input {
      width: 100%; padding: 12px; border: 1px solid #ccc; font-size: 16px;
      text-align: center; outline: none; border-radius: 8px; font-family: inherit;
      background: #f9f9f9;
    }

    .btns { display: flex; width: 100%; gap: 10px; }
    button {
      flex: 1; padding: 15px; border: 1px solid #000; font-weight: bold;
      cursor: pointer; border-radius: 8px; font-size: 14px; font-family: inherit;
      text-transform: uppercase;
    }
    #saveBtn { background: #000; color: #fff; border: none; }
    #clearBtn { background: #fff; color: #000; border-color: #ddd; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>

  <div id="canvas-wrapper">
    <canvas id="canvas"></canvas>
  </div>

  <div id="ui">
    <div class="palette" id="palette"></div>
    <input id="nameInput" type="text" placeholder="–¢–≤–æ—ë –∏–º—è" maxlength="15" />
    <div class="btns">
      <button id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button id="saveBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üéÅ</button>
    </div>
  </div>

  <script>
    // =================================================================
    // üëáüëáüëá –í–°–¢–ê–í–¨ –°–°–´–õ–ö–£ –° RENDER –°–Æ–î–ê (–º–µ–∂–¥—É –∫–∞–≤—ã—á–µ–∫) üëáüëáüëá
    const SERVER_URL = "https://bells-a5zq.onrender.com";
    // =================================================================

    const tg = window.Telegram.WebApp;
    tg.expand();

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // –ù–ê–°–¢–†–û–ô–ö–ò –†–ê–ó–ú–ï–†–û–í (–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Render Free)
    // H_DRAW - –º–µ—Å—Ç–æ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è (2200px)
    // H_TOTAL - –æ–±—â–∞—è –≤—ã—Å–æ—Ç–∞ —Å –ø–æ–¥–≤–∞–ª–æ–º (2800px). 
    // –†–∞–∑–Ω–∏—Ü–∞ 600px - —ç—Ç–æ –º–µ—Å—Ç–æ –ø–æ–¥ —Ç–µ–∫—Å—Ç –≤–Ω–∏–∑—É.
    const W = 2000, H_DRAW = 2200, H_TOTAL = 2800; 
    canvas.width = W; 
    canvas.height = H_DRAW;

    function init() { 
        ctx.fillStyle = '#fff'; 
        ctx.fillRect(0,0,W,H_DRAW); 
    }
    init();

    const colors = ['#dc2626', '#22c55e', '#fbbf24', '#1e293b', '#06b6d4', '#ec4899', '#ffffff'];
    let curCol = colors[0];
    const palDiv = document.getElementById('palette');

    colors.forEach(c => {
      const d = document.createElement('div');
      d.className = 'color-dot';
      d.style.background = c;
      if(c === '#ffffff') d.style.border = '1px solid #ddd';
      d.onclick = () => {
        document.querySelectorAll('.color-dot').forEach(el=>el.classList.remove('active'));
        d.classList.add('active'); curCol = c;
      };
      palDiv.appendChild(d);
    });
    palDiv.children[0].classList.add('active');

    const wishes = [
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –º—É–∑–∞ –ø–æ—Å–µ—â–∞–µ—Ç —Ç–µ–±—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.",
      "–ñ–µ–ª–∞—é –≤ 2026 –≥–æ–¥—É –Ω–∞–π—Ç–∏ —Ç–æ—Ç —Å–∞–º—ã–π –∏–¥–µ–∞–ª—å–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫!",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ç–≤–æ–π –ø–∏–∫—Å–µ–ª—å –±—É–¥–µ—Ç –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –¢–≤–æ—Ä–∏ —Ç–∞–∫, –∫–∞–∫ –≤–µ–ª–∏—Ç —Å–µ—Ä–¥—Ü–µ, –∞ –Ω–µ –º–æ–¥–∞.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–ª–∏—Å—å –≤ —à–µ–¥–µ–≤—Ä—ã.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –ª—É—á—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ñ–µ–ª–∞—é –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–≤–µ–∂–∏—Ö –∏–¥–µ–π.",
      "–ü—É—Å—Ç—å —Ç–≤–æ—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤ –≥–æ–ª–æ–≤–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è.",
      "–ñ–µ–ª–∞—é –≤–∏–¥–µ—Ç—å –∫—Ä–∞—Å–æ—Ç—É –≤ —Å–∞–º—ã—Ö –æ–±—ã—á–Ω—ã—Ö –≤–µ—â–∞—Ö.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —à—Ç—Ä–∏—Ö –±—É–¥–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω—ã–º –∏ —Ç–æ—á–Ω—ã–º.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–∏ —Ç—ã—Å—è—á–∏ –ª—é–¥–µ–π.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–¥–æ—Å—Ç—å.",
      "–ñ–µ–ª–∞—é —Ç–µ–±–µ –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –≤—ã—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ —É—Å–ø–µ—Ö–∞ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö!",
      "–ü—É—Å—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≤ –∂–∏–∑–Ω–∏ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–π.",
      "–ñ–µ–ª–∞—é –Ω–∞–π—Ç–∏ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º–æ–º –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ö–æ–ª—Å—Ç –¥–∞—Ä–∏—Ç –ø—Ä–µ–¥–≤–∫—É—à–µ–Ω–∏–µ —á—É–¥–∞.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å—Ç–∞–ª —É–∑–Ω–∞–≤–∞–µ–º—ã–º.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ù–µ –±–æ–π—Å—è –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∏.",
      "–ü—É—Å—Ç—å 2026-–π —Å—Ç–∞–Ω–µ—Ç –≥–æ–¥–æ–º —Ç–≤–æ–µ–≥–æ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ä—ã–≤–∞!",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ—è –ø–∞–ª–∏—Ç—Ä–∞ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∞ —Å–æ—á–Ω–æ–π –∏ —è—Ä–∫–æ–π.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å —Å–æ—Ñ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ç—ã —É—Å–ø–µ–≤–∞–µ—à—å –º–æ—Ä–≥–Ω—É—Ç—å.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã Ctrl+Z —Ç–µ–±–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–≥–æ–∂–¥–∞–ª—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏.",
      "–ü—É—Å—Ç—å –≤—Å–µ —Å–ª–æ–∏ –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –ø–æ–¥–ø–∏—Å–∞–Ω—ã (–Ω—É, —Ö–æ—Ç—è –±—ã –ø–æ–ª–æ–≤–∏–Ω–∞!).",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª–∞—Å—å.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å —Ç–≤–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ.",
      "–ñ–µ–ª–∞—é –∏–¥–µ–∞–ª—å–Ω–æ–π —Ü–≤–µ—Ç–æ–ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ –≤—Å–µ—Ö –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö –º–∏—Ä–∞.",
      "–ü—É—Å—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω–æ –Ω—É–∂–Ω–æ.",
      "–ü—É—Å—Ç—å Figma/Photoshop –Ω–µ –≤—ã–¥–∞—é—Ç –æ—à–∏–±–æ–∫ –≤ —Å–∞–º—ã–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ñ–µ–ª–∞—é –Ω–∞–π—Ç–∏ —Ç–æ—Ç —Å–∞–º—ã–π —à—Ä–∏—Ñ—Ç –±–µ–∑ –∑–∞—Å–µ—á–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –ª–µ—á–∏—Ç –¥—É—à—É.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –±–µ–∑ ¬´—Å—Ç—É–ø–µ–Ω–µ–∫¬ª.",
      "–ü—É—Å—Ç—å –ø–∞–ø–∫–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è ¬´Final¬ª, –∞ –Ω–µ ¬´Final_v28_copy¬ª.",
      "–ñ–µ–ª–∞—é –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ª—é–±—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –∞—Å—Å–µ—Ç–æ–≤.",
      "–ñ–µ–ª–∞—é —á–∏—Å—Ç—ã—Ö –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∏ –ø–æ—Ä—è–¥–∫–∞ –≤ —Ñ–∞–π–ª–∞—Ö.",
      "–ü—É—Å—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –æ—Ç–ø–µ—á–∞—Ç–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–Ω—Å—Ç–∏–Ω–∫—Ç–æ–≤.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏–ª —Å –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏.",
      "–ü—É—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–≤–æ–∏—Ö –∏–¥–µ–π –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç 300+ DPI.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –≥–ª–∞–∑–∞ –æ—Ç–¥—ã—Ö–∞—é—Ç, –∞ –¥—É—à–∞ —Ä–∞–¥—É–µ—Ç—Å—è.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –¥–∏–∑–∞–π–Ω –±—ã–ª —Ç–≤–æ–∏–º –ª—é–±–∏–º—ã–º —Ö–æ–±–±–∏ –∏ –ø—Ä–∏–Ω–æ—Å–∏–ª —Å—á–∞—Å—Ç—å–µ.",
      "–ü—É—Å—Ç—å 2026-–π –±—É–¥–µ—Ç –ø–æ–ª–æ–Ω —è—Ä–∫–∏—Ö –∫—Ä–∞—Å–æ–∫ –∏ —Ç–µ–ø–ª—ã—Ö –≤—Å—Ç—Ä–µ—á.",
      "–ñ–µ–ª–∞—é –Ω–∞–π—Ç–∏ –≤—Ä–µ–º—è –Ω–∞ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –¥–∞–∂–µ –≤ —Å–∞–º—ã–π –∑–∞–Ω—è—Ç–æ–π –¥–µ–Ω—å.",
      "–ü—É—Å—Ç—å —Ç–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –¥–∞—Ä—è—Ç —É–ª—ã–±–∫–∏ –æ–∫—Ä—É–∂–∞—é—â–∏–º.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ë–æ–ª—å—à–µ —Å–Ω–∞, –º–µ–Ω—å—à–µ –ø—Ä–∞–≤–æ–∫ (–¥–∞–∂–µ –æ—Ç —Å–∞–º–æ–≥–æ —Å–µ–±—è).",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –∫–æ—Ñ–µ –≤—Å–µ–≥–¥–∞ –±—ã–ª –≥–æ—Ä—è—á–∏–º, –∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ ‚Äî —Å–≤–µ–∂–∏–º.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ç–≤–æ–π –¥–µ–Ω—å –±—É–¥–µ—Ç –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω–æ —Å–≤–µ—Ä—Å—Ç–∞–Ω–Ω—ã–π –º–∞–∫–µ—Ç.",
      "–ñ–µ–ª–∞—é –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –∏ –Ω–µ–∏—Å—Å—è–∫–∞–µ–º–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞.",
      "–ü—É—Å—Ç—å –±–ª–∏–∑–∫–∏–µ –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ç–≤–æ–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å 2026-–π –±—É–¥–µ—Ç —Å–∞–º—ã–º —Å—Ç–∏–ª—å–Ω—ã–º –≥–æ–¥–æ–º –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —É —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ –±—ã–ª–æ –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∫—Ä–∞—Å–æ–∫ –∏ –∫–∏—Å—Ç–µ–π.",
      "–ñ–µ–ª–∞—é –Ω–∞–π—Ç–∏ —Å–≤–æ–µ–≥–æ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞ –≤ –º–∏—Ä–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –ª–∞–π–∫ –ø–æ–¥ —Ç–≤–æ–µ–π —Ä–∞–±–æ—Ç–æ–π –≥—Ä–µ–µ—Ç —Å–µ—Ä–¥—Ü–µ.",
      "–ñ–µ–ª–∞—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∞—Ä—è—Ç —Å–æ—Ç–Ω–∏ –Ω–æ–≤—ã—Ö –∏–¥–µ–π.",
      "–ü—É—Å—Ç—å —Ç–≤–æ–µ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–Ω–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü –∏ –ø—Ä–∞–≤–∏–ª.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º –±—ã–ª–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å 2026-–π —Å—Ç–∞–Ω–µ—Ç –≥–æ–¥–æ–º –≤–æ–ø–ª–æ—â–µ–Ω–∏—è —Å–∞–º—ã—Ö —Å–º–µ–ª—ã—Ö —ç—Å–∫–∏–∑–æ–≤.",
      "–ü—É—Å—Ç—å –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏ –±—É–¥–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ —Ü–≤–µ—Ç–∞, —Å–∫–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—Ç–∞—Ö –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏—Å—Ç–æ–≤.",
      "–ú–µ–Ω—å—à–µ —à—É–º–∞ ‚Äî –±–æ–ª—å—à–µ —Å–º—ã—Å–ª–∞!",
      "–ü—É—Å—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Å—Ö–æ–¥–∏—Ç—Å—è.",
      "–Ø—Ä–∫–∏—Ö –∏–¥–µ–π –∏ –º—è–≥–∫–∏—Ö —Ç–µ–Ω–µ–π!",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –¢–≤–æ—Ä–∏, –ª—é–±–∏, —Ä–∏—Å—É–π.",
      "–ó–æ–ª–æ—Ç–æ–≥–æ —Å–µ—á–µ–Ω–∏—è —Ç–µ–±–µ –≤–æ –≤—Å—ë–º!",
      "–ü—É—Å—Ç—å –º—É–∑–∞ –Ω–µ —É—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–Ω–∏–∫—É–ª—ã.",
      "–¢–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –ø–æ–ª–µ—Ç–∞ –±–µ–∑ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏!",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ü–≤–µ—Ç –±—É–¥–µ—Ç –∫ –º–µ—Å—Ç—É.",
      "–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è 24/7!",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ñ–≥–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º –æ–≥–Ω–µ–º.",
      "–ë–æ–ª—å—à–µ –≤–æ–∑–¥—É—Ö–∞ –≤ –º–∞–∫–µ—Ç–∞—Ö –∏ –≤ –ª–µ–≥–∫–∏—Ö!",
      "–ü—É—Å—Ç—å –≤—Å—ë –±—É–¥–µ—Ç –ø–æ —Å–µ—Ç–∫–µ, –Ω–æ —Å –¥—É—à–æ–π.",
      "–¢–≤–æ–∏ –∏–¥–µ–∏ ‚Äî —Ç–≤–æ–µ –∑–æ–ª–æ—Ç–æ. –ë–µ—Ä–µ–≥–∏ –∏—Ö!",
      "–ü—É—Å—Ç—å 2026-–π –±—É–¥–µ—Ç –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏.",
      "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü –∏ —Ç–æ—Ä–º–æ–∑–æ–≤!",
      "–†–∏—Å—É–π —Ç–∞–∫, –∫–∞–∫ –Ω–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –Ω–µ —Å–º–æ–∂–µ—Ç.",
      "–ü—É—Å—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç –≤ –∂–∏–∑–Ω–∏ –±—É–¥–µ—Ç –ø—Ä–∏—è—Ç–Ω—ã–º.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ë—É–¥—å –≤ —Ç—Ä–µ–Ω–¥–µ —Å–≤–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞.",
      "–ñ–µ–ª–∞—é —á–∏—Å—Ç–æ–≥–æ —Ö–æ–ª—Å—Ç–∞ –∏ —Å–º–µ–ª–æ–π —Ä—É–∫–∏.",
      "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–∞. –ë—É–¥—å —Å–≤–æ–±–æ–¥–µ–Ω!",
      "–ü—É—Å—Ç—å —Ç–≤–æ–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –º—è–≥—á–µ –æ–±–ª–∞–∫–æ–≤.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∫–ª–∏–∫ –º—ã—à–∫–æ–π –±—ã–ª –≤ —Ä–∞–¥–æ—Å—Ç—å.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –ø–∏–∫—Å–µ–ª–∏ –Ω–µ –¥–≤–æ—è—Ç—Å—è.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ–π –º–æ–Ω–∏—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª –ø—Ä–∞–≤–¥—É.",
      "–ü—É—Å—Ç—å –≤ 2026 –≥–æ–¥—É —Ç–≤–æ—è –ª–∏—á–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ —Ä–∞—Å—à–∏—Ä–∏—Ç—Å—è.",
      "–ñ–µ–ª–∞—é –ø–æ–±–µ–¥ –≤ –ª—é–±—ã—Ö —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –∫–æ–Ω–∫—É—Ä—Å–∞—Ö!",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —ç—Å–∫–∏–∑ –¥–æ—Ä–∞—Å—Ç–∞–µ—Ç –¥–æ —Ñ–∏–Ω–∞–ª–∞.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –¥–∏–∑–∞–π–Ω —Å–ø–∞—Å–∞–µ—Ç —Ç–≤–æ–π –º–∏—Ä.",
      "–ñ–µ–ª–∞—é –Ω–∞–π—Ç–∏ –≥–∞—Ä–º–æ–Ω–∏—é –º–µ–∂–¥—É —Ñ–æ—Ä–º–æ–π –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º.",
      "–ü—É—Å—Ç—å —Ç–≤–æ—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –∑–Ω–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç–∏.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ —Ç–≤–æ–∏—Ö —Ä—É–∫–∞—Ö –±—ã–ª –≤–æ–ª—à–µ–±–Ω—ã–º.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —à—É–º –∏—Å—á–µ–∑–Ω–µ—Ç.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ–∏ —à–µ–¥–µ–≤—Ä—ã –Ω–µ –ø—ã–ª–∏–ª–∏—Å—å –≤ –ø–∞–ø–∫–∞—Ö.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π —Ç–≤–æ–π –ø–æ—Å—Ç –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö –∑–∞–ª–µ—Ç–∞–µ—Ç –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–º–Ω–µ–≤–∞–ª—Å—è –≤ —Å–≤–æ–µ–º —Ç–∞–ª–∞–Ω—Ç–µ.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å 2026-–π –ø—Ä–∏–Ω–µ—Å–µ—Ç –º–æ—Ä–µ —ç—Å—Ç–µ—Ç–∏–∫–∏.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å –æ–±—Ö–æ–¥–∏–ª —Ç–µ–±—è —Å—Ç–æ—Ä–æ–Ω–æ–π.",
      "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã–π –ø–æ–≤–æ–¥ –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞.",
      "–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å —Ç–≤–æ—è –∂–∏–∑–Ω—å –±—É–¥–µ—Ç –∫–∞–∫ —Å–æ—á–Ω—ã–π –≤–µ–∫—Ç–æ—Ä.",
      "–ñ–µ–ª–∞—é, —á—Ç–æ–±—ã –≤—Å—ë –∑–∞–¥—É–º–∞–Ω–Ω–æ–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–ª–æ—Å—å –∏–º–µ–Ω–Ω–æ —Ç–∞–∫, –∫–∞–∫ –Ω–∞–¥–æ!"
    ];

    function wrapText(context, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let n = 0; n < words.length; n++) {
        let testLine = line + words[n] + ' ';
        let testWidth = context.measureText(testLine).width;
        if (testWidth > maxWidth && n > 0) {
          context.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else { line = testLine; }
      }
      context.fillText(line, x, y);
    }

    function getPos(e) {
      const r = canvas.getBoundingClientRect();
      const t = e.touches ? e.touches[0] : e;
      return { 
        x: (t.clientX - r.left) * (W/r.width), 
        y: (t.clientY - r.top) * (H_DRAW/r.height) 
      };
    }

    let drawing = false, lastX=0, lastY=0;

    // –ö–∏—Å—Ç—å –ë–∞—Å–∫–∏–∏
    function basquiat(x, y) {
      for (let i=0; i<34; i++) {
        const r = (20 + Math.random()*50), ang = Math.random()*Math.PI*2, dist = r*Math.sqrt(Math.random());
        ctx.globalAlpha = 0.6 + Math.random()*0.3; 
        ctx.fillStyle = curCol;
        ctx.beginPath(); 
        ctx.arc(x + Math.cos(ang)*dist, y + Math.sin(ang)*dist, (3+Math.random()*6)*3, 0, Math.PI*2); 
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    canvas.onpointerdown = (e) => { 
        e.preventDefault(); 
        drawing=true; 
        const p=getPos(e); 
        lastX=p.x; lastY=p.y; 
        basquiat(p.x, p.y); 
    };

    canvas.onpointermove = (e) => {
      if(!drawing) return;
      e.preventDefault();
      const p=getPos(e);
      
      for(let i=0; i<20; i++){
        const t=i/20, bx=lastX+(p.x-lastX)*t, by=lastY+(p.y-lastY)*t;
        ctx.strokeStyle=curCol; 
        ctx.lineWidth=(4+Math.random()*7)*3; 
        ctx.globalAlpha=0.7; 
        ctx.lineCap='round';
        ctx.beginPath(); 
        ctx.moveTo(bx+(Math.random()-0.5)*10, by+(Math.random()-0.5)*10);
        ctx.lineTo(bx+(Math.random()-0.5)*15, by+(Math.random()-0.5)*15); 
        ctx.stroke();
      }
      lastX=p.x; lastY=p.y;
    };
    
    window.onpointerup = () => drawing=false;
    window.onpointercancel = () => drawing=false;

    document.getElementById('clearBtn').onclick = () => { 
        tg.HapticFeedback.impactOccurred('medium');
        if(confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç?')) init(); 
    };

    document.getElementById('saveBtn').onclick = async (e) => {
      e.preventDefault();
      
      // –ü–†–û–í–ï–†–ö–ê –ù–ê–õ–ò–ß–ò–Ø –°–°–´–õ–ö–ò
      if (!SERVER_URL || SERVER_URL === "https://—Ç–≤–æ–µ-–Ω–∞–∑–≤–∞–Ω–∏–µ-–Ω–∞-render.onrender.com") {
          alert("–û–®–ò–ë–ö–ê: –¢—ã –∑–∞–±—ã–ª –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É —Å Render –≤ –∫–æ–¥ —Ñ–∞–π–ª–∞ index.html!");
          return;
      }

      tg.HapticFeedback.notificationOccurred('success');
      
      const btn = document.getElementById('saveBtn');
      if (btn.disabled) return;
      const name = document.getElementById('nameInput').value.trim() || '–¢–≤–æ—Ä–µ—Ü';
      
      btn.disabled = true; 
      btn.innerText = '–£–ü–ê–ö–û–í–ö–ê...';

      const temp = document.createElement('canvas'); 
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
      temp.width = W; 
      temp.height = H_TOTAL;
      const tctx = temp.getContext('2d');
      
      tctx.fillStyle = '#fff'; 
      tctx.fillRect(0, 0, W, H_TOTAL);
      tctx.drawImage(canvas, 0, 0);

      const randomWish = wishes[Math.floor(Math.random() * wishes.length)];
      tctx.fillStyle = '#000'; 
      tctx.textAlign = 'center';
      
      // –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ó–î–ï–°–¨:
      // 1. –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç –∏–º–µ–Ω–∏ —Å–æ 130px –¥–æ 90px
      // 2. –°–ø—É—Å—Ç–∏–ª –∏–º—è –Ω–∏–∂–µ (H_TOTAL - 400)
      tctx.font = 'bold 90px Liter';
      tctx.fillText(name, W/2, H_TOTAL - 400);
      
      // 3. –£–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç –ø–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ 100px –¥–æ 65px
      // 4. –°–ø—É—Å—Ç–∏–ª –ø–æ–∂–µ–ª–∞–Ω–∏–µ –µ—â–µ –Ω–∏–∂–µ (H_TOTAL - 250)
      tctx.font = '65px Liter';
      wrapText(tctx, randomWish, W/2, H_TOTAL - 250, 1800, 90);

      // –ö–∞—á–µ—Å—Ç–≤–æ 0.5 (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Render Free)
      const dataUrl = temp.toDataURL('image/jpeg', 0.5);

      btn.innerText = '–û–¢–ü–†–ê–í–ö–ê...';

      try {
        const res = await fetch(SERVER_URL + '/upload_image', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ 
              image: dataUrl, 
              user_id: tg.initDataUnsafe?.user?.id 
          })
        });
        
        if(res.ok) {
            tg.close();
        } else {
            throw new Error('Server returned ' + res.status);
        }
      } catch(err) { 
        console.error(err);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + err.message); 
        btn.disabled = false; 
        btn.innerText = '–û–¢–ü–†–ê–í–ò–¢–¨ üéÅ'; 
      }
    };
  </script>
</body>
</html>
